FUNCTION CTA_BAN(CTA_BAN1,NIVEL)
LOCAL CTA_BAN21:="",CTA_BAN22:="",CTA_BAN23:="",CTA_BAN24:=""
NIVEL:=IF(NIVEL=NIL,0,NIVEL)
***NIVEL 0 = COMPROBAR CUENTA DC C/RESPUETA
***NIVEL 1 = DEVOLVER SI ES ERRONEA
***NIVEL 2 = COMPROBAR CUENTA DC S/RESPUETA
ERRORCTA:=0

CTA_BAN2:=CTA_BAN_SUIZO(CTA_BAN1,20)

   CTA_BAN21:=ALLTRIM(SUBSTR(CTA_BAN2, 1,4))
   CTA_BAN22:=ALLTRIM(SUBSTR(CTA_BAN2, 5,4))
   CTA_BAN23:=ALLTRIM(SUBSTR(CTA_BAN2, 9,2))
   CTA_BAN24:=ALLTRIM(SUBSTR(CTA_BAN2,11,10))

CTA_BAN23:=PADL(CTA_BAN23,2," ")
IF LEN(CTA_BAN21)=4 .AND. LEN(CTA_BAN22)=4 .AND. LEN(CTA_BAN24)=10
   CTA_BAN29:=           VAL(SUBSTR(CTA_BAN21,1,1))*4
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN21,2,1))*8 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN21,3,1))*5 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN21,4,1))*10)
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN22,1,1))*9 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN22,2,1))*7 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN22,3,1))*3 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN22,4,1))*6 )
   CTA_BANDC1:=11-(CTA_BAN29-(INT(CTA_BAN29/11)*11))
   CTA_BANDC1:=IF(CTA_BANDC1>9,IF(CTA_BANDC1=10,1,0),CTA_BANDC1)
   CTA_BAN29:=           VAL(SUBSTR(CTA_BAN24,1,1))*1
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,2,1))*2 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,3,1))*4 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,4,1))*8 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,5,1))*5 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,6,1))*10)
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,7,1))*9 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,8,1))*7 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,9,1))*3 )
   CTA_BAN29:=CTA_BAN29+(VAL(SUBSTR(CTA_BAN24,10,1))*6)
   CTA_BANDC2:=11-(CTA_BAN29-(INT(CTA_BAN29/11)*11))
   CTA_BANDC2:=IF(CTA_BANDC2>9,IF(CTA_BANDC2=10,1,0),CTA_BANDC2)
   CTA_BANDC:=(CTA_BANDC1*10)+CTA_BANDC2
   CTA_BANDC:=PADL(LTRIM(STR(CTA_BANDC)),2,"0")

   CTA_BAN2:=SUBSTR(CTA_BAN2,1,8 )+CTA_BANDC+SUBSTR(CTA_BAN2,11,10)

   IF CTA_BAN23<>CTA_BANDC .AND. CTA_BAN23<>"  "
      ERRORCTA:=0
   ELSE
      ERRORCTA:=1
   ENDIF
ELSE
   IF LEN(LTRIM( STRTRAN(CTA_BAN2,"-"," ") ))<>0
      ERRORCTA:=0
   ELSE
      ERRORCTA:=1
   ENDIF
ENDIF

DO CASE
CASE NIVEL=0
   IF ERRORCTA=0
      MSGSTOP("Cuenta Bancaria Erronea")
/*
      PAN_CTA:=SAVESCREEN(0,0,24,79)
      SETCOLOR(COLORCU2)
      @ 24,25 CLEAR TO 24,53
      @ 24,28 SAY "CUENTA BANCARIA ERRONEA"
      INKEY(0)
      RESTSCREEN(0,0,24,79,PAN_CTA)
      SETCOLOR(MICOLOR)
*/
   ENDIF
   RETURN(CTA_BAN_SUIZO(CTA_BAN2,LEN(CTA_BAN1)))
CASE NIVEL=1
   RETURN(ERRORCTA)
CASE NIVEL=2
   RETURN(CTA_BAN_SUIZO(CTA_BAN2,LEN(CTA_BAN1)))
ENDCASE



FUNCTION CTA_BAN_SUIZO(CTA_BAN2,NIVEL)
NIVEL:=IF(NIVEL=NIL,20,NIVEL)
***NIVEL 1 = CONVERTIR A 20
***NIVEL 2 = CONVERTIR A 24
***NIVEL 3 = CONVERTIR A 30
CTA_BAN2:=STRTRAN(CTA_BAN2," ","")
CTA_BAN2:=STRTRAN(CTA_BAN2,"-","")
CTA_BAN2:=PADL(CTA_BAN2,20," ")
DO CASE
CASE NIVEL=1 .OR. NIVEL=20
   CTA_BAN3:=CTA_BAN2
CASE NIVEL=2 .OR. NIVEL=24
   CTA_BAN3:=SUBSTR(CTA_BAN2, 1, 4)+"-"+ ;
             SUBSTR(CTA_BAN2, 5, 4)+"-"+ ;
             SUBSTR(CTA_BAN2, 9, 2)+"-"+ ;
             SUBSTR(CTA_BAN2,11,10)
CASE NIVEL=3 .OR. NIVEL=30
   CTA_BAN3:=" "+ ;
             SUBSTR(CTA_BAN2, 1, 4)+"-"+ ;
             SUBSTR(CTA_BAN2, 5, 4)+" -"+ ;
             SUBSTR(CTA_BAN2, 9, 2)+"-"+ ;
             SUBSTR(CTA_BAN2,11,10)+SPACE(5)
OTHERWISE
   CTA_BAN3:=PADR(CTA_BAN2,NIVEL," ")
ENDCASE
RETURN(CTA_BAN3)
